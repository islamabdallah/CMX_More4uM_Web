@model MoreForYou.Services.Models.API.Medical.MedicalRequestDetailsModel

@{
    ViewData["Title"] = "Home";
    ViewData["SubTitle"] = "My Benefits";
    ViewData["activ"] = "MRequest";
    Layout = "~/Views/Shared/_More4ULayout.cshtml";
    var type = "";
    string optionId = "";
    var itemNum = "";
}
<link href="~/css/newStyleSheet.css" rel="stylesheet" />
<script src="~/js/JQuery/jquery-3.5.1.js"></script>
<script src="~/js/sweetalert.min.js"></script>

<script src="~/searchableDD/jquery.dropdown.js"></script>
<script src="~/searchableDD/jquery.dropdown.min.js"></script>
<script src="~/searchableDD/select2.js"></script>
<link rel="stylesheet" href="~/searchableDD/jquery.dropdown.css" />
<link rel="stylesheet" href="~/searchableDD/jquery.dropdown.min.css" />
<link rel="stylesheet" href="~/searchableDD/select2.css" />
<script src="~/js/sweetalert.min.js"></script>
<style>
    .modernWay {
        overflow: hidden;
        text-overflow: ellipsis;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        min-width: auto;
        max-width: 200px;    
    }
</style>
<script>
    function showAlert(type) {
        if (type == "Message") {
            var message = document.getElementById("message").value;
            swal({
                title: "Done Succesfully !",
                text: message,
                icon: "success",
            });
        }
        else {
            var error = document.getElementById("error").value;
            swal({
                title: "Fail !",
                text: error,
                icon: "error",
            });
        }
    }
</script>

@if (ViewBag.Message != null)
{
    <input type="hidden" id="message" value="@ViewBag.Message" />
    <script>
        showAlert("Message");
    </script>
}
@if (Model.MedicalRequest.requestType == 1)
{
    type = "Medication";
}
else if (Model.MedicalRequest.requestType == 2)
{
    type = "CheckUps";
}
else
{
    type = "SickLeave";
}

<!-- Modal -->
<div class="modal fade" id="exampleModalMessage" tabindex="-1" role="dialog" aria-labelledby="exampleModalMessageTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Approve Medical Request </h5>
                <button type="button" class="btn-close text-dark" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <style>
                    #ResourceTable, #ResourceTable th, #ResourceTable td {
                        border: 1px solid black;
                        border-collapse: collapse;
                        text-align: center;
                    }
                        }
                </style>
                <form>
                    <div class="form-group" id="lmtable" hidden>
                        <label for="recipient-name" class="col-form-label">Medical Items Details:</label>
                       @*  <table class="table table-bordered" id="ResourceTable"> *@
                        <table class="table datatable align-items-center mb-0" id="ResourceTable">
                            <thead>
                                
                                <th>Id</th>
                                <th>DrugName</th>
                                <th>Type</th>
                                <th>Dose</th>
                            <th>Quantity</th>
                            </thead>
                            <tbody id="lmtbody">

                            </tbody>
                        </table>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Comment:</label>
                        <textarea class="form-control" id="message-text"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn bg-gradient-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn bg-gradient-info" onclick="getTable()">Approve </button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="exampleModalReject" tabindex="-1" role="dialog" aria-labelledby="exampleModalMessageTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Reject Medical Request </h5>
                <button type="button" class="btn-close text-dark" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                   
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Comment:</label>
                        <textarea class="form-control" id="message-textlm"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn bg-gradient-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn bg-gradient-danger" onclick="getReject()">Reject </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="exampleModalApprove" tabindex="-1" role="dialog" aria-labelledby="exampleModalMessageTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Approve Medical Request </h5>
                <button type="button" class="btn-close text-dark" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <form>

                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Comment:</label>
                        <textarea class="form-control" id="message-textlmm"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn bg-gradient-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn bg-gradient-info" onclick="getApprovee()">Approve </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ImageSlider" tabindex="-1" role="dialog" aria-labelledby="exampleModalMessageTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Request Attachment </h5>
                <button type="button" class="btn-close text-dark" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Slides with controls -->
                <div class="row pt-3">
                    <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="~/assets/img/slides-1.jpg" class="d-block w-100" alt="..." height="600" id="ViolationImageID">
                            </div>
                            <input type="hidden" id="violationImgs" value="" />
                           
                            <input id="currentViolationImgsNumber" type="hidden" />
                        </div>

                        <button class="carousel-control-prev" type="button" onclick="changeImage('down')">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" onclick="changeImage('up')">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>

                    </div><!-- End Slides with controls -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn bg-gradient-secondary" data-bs-dismiss="modal">Close</button>
               @*  <button type="button" class="btn bg-gradient-danger" onclick="getReject()">Reject </button> *@
            </div>
        </div>
    </div>
</div>
</div>


@if (Model != null)
{
    <div class="row">

        <div class="col-lg-6" id="">
            <div class="col-xl-12">
                <div class="col-lg-12 mb-lg-0 mb-4 mt-3" id="">
                    <div class="card">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="d-flex flex-column h-100">

                                        <p class="mb-1 pt-2 text-bold"><span>@type</span> Request</p>
                                        <h5 class="font-weight-bolder text-gradient text-info">Request Details</h5>
                                    </div>
                                </div>
                                @*   <div class="col-lg-4 ms-auto text-center mt-5 mt-lg-0"> *@
                                <div class="col-md-4 d-flex justify-content-end align-items-center">

                                    @*   <div class="bg-gradient-primary border-radius-lg h-100 w-50">
                                <div class="position-relative d-flex h-100">
                                <img class="w-100 position-relative z-index-2 border-radius-lg p-1" src="@ViewBag.Picture" alt="rocket">
                                </div>
                                </div> *@
                                    @*  <div class="d-flex flex-column h-100"> *@
                                    @*  <i class="fa fa-repeat me-2"></i> *@
                                    <i class="fa fa-hashtag me-2"></i>

                                    <strong id="RequestsCount">@Model.MedicalRequestId</strong>
                                    @*  </div> *@
                                </div>
                            </div>

                            <hr class="horizontal dark my-sm-4">

                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="d-flex flex-column h-100">
                                        <p class="mb-5">
                                            <b>Request Status :</b>
                                            @if (Model.RequestStatus == "Pending")
                                            {
                                                <span class="badge badge-sm bg-gradient-warning pr-5">@Model.RequestStatus</span>
                                            }
                                            else if (Model.RequestStatus == "Approved")
                                            {
                                                <span class="badge badge-sm bg-gradient-success pr-5">@Model.RequestStatus</span>
                                            }
                                            else if (Model.RequestStatus == "Rejected")
                                            {
                                                <span class="badge badge-sm bg-gradient-danger pr-5">@Model.RequestStatus</span>
                                            }
                                            <br /><b>Created By :</b>@Model.MedicalRequest.createdBy
                                            <br /><b>Requested By :</b>@Model.MedicalRequest.requestedBy
                                            <br /><b> Requested For:</b>@Model.MedicalRequest.requestedFor
                                            <br /><b>Relation :</b>@Model.MedicalRequest.relation
                                            <br /><b>Monthly Medication :</b>@Model.MedicalRequest.monthlyMedication
                                            <br /><b>Relative Coverage:</b>@Model.MedicalRequest.relativeCoverage
                                            <br /><b>Date  : </b>@Model.MedicalRequest.requestDate
                                            <br /><b>Medical Entity:</b>@Model.MedicalRequest.MedicalEntity
                                            <br /><b>Medical Purpose :</b>@Model.MedicalRequest.medicalPurpose
                                            <br /><b>Comment :</b>@Model.MedicalRequest.comment
                                            <br /><b>Attachments :</b>&nbsp;&nbsp;
                                            @if (Model.MedicalRequest.attachment != null)
                                            {
                                                if (Model.MedicalRequest.attachment.Count > 0)
                                                {
                                                    <a onclick="showAttachment(@JsonSerializer.Serialize(Model.MedicalRequest.attachment));">
                                                        <i class="fa fa-paperclip"></i>
                                                    </a>

                                                }
                                            }
                                            else
                                            {
                                                <span>No attachment</span>
                                            }
                                        </p>

                                       @*  <a class="text-body text-sm font-weight-bold mb-0 icon-move-right mt-auto" href="#">
                                            Details
                                            <i class="fas fa-arrow-right text-sm ms-1" aria-hidden="true"></i>
                                        </a> *@
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        @if (Model.RequestStatus == "Pending")
        {
            <div class="col-lg-6" id="myBenefits">
                <div class="col-xl-12">
                    <div class="col-lg-12 mb-lg-0 mb-4 mt-3" id="">
                        <div class="card">
                            <div class="card-body p-3">
                                <div class="row">
                                    <div class="col-lg-8">
                                        <div class="d-flex flex-column h-100">

                                            <p class="mb-1 pt-2 text-bold"><span>@type</span> Request</p>
                                            <h5 class="font-weight-bolder text-gradient text-info">Add Response</h5>
                                        </div>
                                    </div>
                                 
                                    <div class="col-md-4 d-flex justify-content-end align-items-center">

                                       
                                        <i class="fa fa-hashtag me-2"></i>

                                        <strong id="RequestsCount">@Model.MedicalRequestId</strong>
                                      
                                    </div>
                                </div>

                                <hr class="horizontal dark my-sm-4">

                                <div class="row">
                                    <div class="form-group col-lg-6" style="margin-bottom:15px">
                                        <p class="mb-5">
                                            <input id="SelectedRequestId" value="@Model.MedicalRequestId" hidden />
                                            Medical Entity

                                            <select class="form-control form-select col-md-1" placeholder="Select UserName"
                                                    id="select-users" value="Model.MedicalRequest.MedicalEntityId" asp-items="@(new SelectList(Model.MedicalResponse.medicalEntities,"MedicalEntityId" ,"MedicalDetailsName",Model.MedicalRequest.MedicalEntityId))">
                                            </select>
                                        </p>
                                    </div>
                                    @if (Model.MedicalResponse.medicalItems.Count > 0)
                                    {
                                        <div class="form-group col-lg-6" style="margin-bottom:15px" id="itemDiv">
                                            <p class="mb-5">
                                                <input id="SelectedEmployeeNumbers" value="" hidden />
                                                Medical Items

                                                <select style="display:none; width:100%" class="dropdown-mul-1 col-lg-8 form-control" name="" id="id_select2_example"
                                                        multiple onchange="test(this)"
                                                        asp-items="@( new SelectList(Model.MedicalResponse.medicalItems,"itemId","itemName"))">
                                                    @for (int index = 0; index < Model.MedicalResponse.medicalItems.Count; index++)
                                                    {
                                                        optionId = "optionId" + index;
                                                        itemNum = @Model.MedicalResponse.medicalItems[index].itemId;
                                                        <option value="@itemNum"
                                                                data-value="@itemNum"
                                                                data-img_src="/~/images/userProfile/userProfile1.png" id="@optionId">
                                                            @Model.MedicalResponse.medicalItems[index].itemName
                                                        </option>
                                                    }
                                                </select>
                                            </p>
                                        </div>
                                    }

                                    <div class="form-group col-lg-12" style="margin-bottom:15px">
                                        <p>
                                           
                                            <div class="text-left">
                                                @if (Model.MedicalResponse.medicalItems.Count > 0)
                                                {
                                                    <button type="submit" class="btn bg-gradient-info" onclick="approve()">
                                                        Approve
                                                    </button>
                                                }
                                                else
                                                {
                                                    <button type="submit" class="btn bg-gradient-info" onclick="approvee()">
                                                        Approve
                                                    </button>
                                                }
                                                <button type="submit" class="btn bg-gradient-danger" onclick="reject()">
                                                    Reject
                                                </button>
                                            </div>
                                            <div class="text-left">

                                            </div>
                                        </p>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="col-lg-6" id="myBenefits">
                <div class="col-xl-12">
                    <div class="col-lg-12 mb-lg-0 mb-4 mt-3" id="">
                        <div class="card">
                            <div class="card-body p-3">
                                <div class="row">
                                    <div class="col-lg-8">
                                        <div class="d-flex flex-column h-100">

                                            <p class="mb-1 pt-2 text-bold"><span>@type</span> Request</p>
                                            <h5 class="font-weight-bolder text-gradient text-info">Response Details</h5>
                                        </div>
                                    </div>
                                    @*   <div class="col-lg-4 ms-auto text-center mt-5 mt-lg-0"> *@
                                    <div class="col-md-4 d-flex justify-content-end align-items-center">

                                        @*   <div class="bg-gradient-primary border-radius-lg h-100 w-50">
                                <div class="position-relative d-flex h-100">
                                <img class="w-100 position-relative z-index-2 border-radius-lg p-1" src="@ViewBag.Picture" alt="rocket">
                                </div>
                                </div> *@
                                        @*  <div class="d-flex flex-column h-100"> *@
                                        @*  <i class="fa fa-repeat me-2"></i> *@
                                        <i class="fa fa-hashtag me-2"></i>

                                        <strong id="RequestsCount">@Model.MedicalRequestId</strong>
                                        @*  </div> *@
                                    </div>
                                </div>

                                <hr class="horizontal dark my-sm-4">

                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="d-flex flex-column h-100">
                                            <p class="mb-5">
                                                <b>Created By :</b>@Model.MedicalResponse.createdBy

                                                <br /><b>Date  : </b>@Model.MedicalResponse.responseDate
                                                <br /><b>FeedBack :</b>@Model.MedicalResponse.feedback
                                                <br /><b>Comment  :</b>@Model.MedicalResponse.responseComment
                                                <br /><b>Entity :</b>@Model.MedicalResponse.medicalEntity
                                            </p>
                                            @if (Model.MedicalResponse.medicalItems != null)
                                            {
                                                if (Model.MedicalResponse.medicalItems.Count > 0)
                                                {
                                                    <p>

                                                        <b>MedicalItems :</b>
                                                    </p>
                                                    <div class="card-body p-3">
                                                        <div class="timeline timeline-one-side">
                                                            @foreach (var item in Model.MedicalResponse.medicalItems)
                                                            {
                                                                <div class="timeline-block">
                                                                    <span class="timeline-step">
                                                                        <i class="ni ni-money-coins text-dark text-gradient"></i>
                                                                    </span>
                                                                    <div class="timeline-content">
                                                                        <h6 class="text-dark text-sm font-weight-bold mb-0">@item.itemName</h6>
                                                                        <p class="text-secondary font-weight-bold text-xs mt-1 mb-0">@item.itemQuantity<span> Item</span></p>
                                                                    </div>
                                                                </div>
                                                            }
                                                        </div>
                                                    </div>
                                                }
                                            }


                                          @*   <a class="text-body text-sm font-weight-bold mb-0 icon-move-right mt-auto" href="#">
                                                Details
                                                <i class="fas fa-arrow-right text-sm ms-1" aria-hidden="true"></i>
                                            </a> *@
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }

    </div>
}
else
{
    <div class="card p-4">
        <div class="card-body p-3">
            <div class="row">
                <div class="card p-3">
                    <div class="col-lg-8 my-auto">
                        <h5>You have no Benefits Requests  </h5>
                        <p class="lead">
                            <span class="font-weight-normal text-gradient text-primary">
                                My Benefits contains all the benefits requests/ history that you have made. Following request details /status (acceptance, rejection, and comments).
                            </span>
                        </p>
                        <a type="button" class="btn bg-gradient-dark mt-4" asp-controller="Benefit" asp-action="ShowBenefits">Go to Dashboard</a>
                    </div>
                    @*         <div class="col-lg-6 my-auto position-relative">
                <img class="w-100 position-relative" src="~/softui/assets/img/illustrations/error-404.png" alt="404-error">
                </div> *@
                </div>
            </div>
        </div>
    </div>
}
<script src="~/js/mybenefitsjs.js"></script>
<script src="~/SoftUI/assets/js/plugins/perfect-scrollbar.min.js"></script>
<script src="~/SoftUI/assets/js/plugins/smooth-scrollbar.min.js"></script>

<script>
        function showAttachment(images) {
       // alert(images)
           
            document.getElementById("violationImgs").innerText = images;
         //  alert(document.getElementById("violationImgs").innerText);
            document.getElementById("currentViolationImgsNumber").innerText = 0;
       // alert(document.getElementById("currentViolationImgsNumber").innerText);
            document.getElementById("ViolationImageID").src = images[0];
            $('#ImageSlider').modal('show');
        }

    function changeImage(status) {

        var currentImgIndex = parseInt(document.getElementById("currentViolationImgsNumber").innerText);
        var newIndex = 0;
        var images = document.getElementById("violationImgs").innerText.split(",");
        //  alert(images);
        //  alert(images.length);
      //  alert(document.getElementById("violationImgs").innerText);
        // var probabilities = document.getElementById("violationProbabilities").innerText.split(",");
        if (status == "up") {
            if (currentImgIndex == images.length - 1) {
                document.getElementById("ViolationImageID").src = images[currentImgIndex];
                // document.getElementById("Confidence").innerText = probabilities[newIndex];
            }
            else {
                newIndex = currentImgIndex + 1;
                document.getElementById("ViolationImageID").src = images[newIndex];
                // document.getElementById("Confidence").innerText = probabilities[newIndex];
                document.getElementById("currentViolationImgsNumber").innerText = newIndex;

            }
        }
        else if (status == "down") {
            if (currentImgIndex == 0) {
                document.getElementById("ViolationImageID").src = images[currentImgIndex];
                // document.getElementById("Confidence").innerText = probabilities[images.length - 1];
            }
            else {
                newIndex = currentImgIndex - 1;
                document.getElementById("ViolationImageID").src = images[newIndex];
                // document.getElementById("Confidence").innerText = probabilities[newIndex];
                document.getElementById("currentViolationImgsNumber").innerText = newIndex;
            }
        }
    }


</script>

<script>

    function hideimg() {

        console.log("done");
        $('#display').modal('hide');
    }

</script>
<script>
    var counter = 1;
    var maxNumber = 20;
    var minNumber =1;

    $('.dropdown-mul-1').dropdown({
        //data: json1.data,
        limitCount: 40,
        multipleMode: 'label',
        choice: function () {

            console.log("test");
        }
    });
    function custom_template(obj) {
        counter++;
        var data = $(obj.element).data();
        var text = $(obj.element).text();
        if (data && data['img_src']) {
            img_src = data['img_src'];
            value = data['value'];
            template = $("<div style=\" width:auto; height:20px;   display: flex; padding:0px\" id=" + value + "><span style=\"font-weight: 100;font-size:10pt;text-align:center; padding:5px\" id=\"lmtest\">" + text + "</span><span style=\"font-weight: 200;font-size:13pt;text-align:center; padding:5px\">" + value + "</span></div>");
            return template;
        }
    }
    //function matchStart(params, data) {
    //    // If there are no search terms, return all of the data
    //    if ($.trim(params.term) === '') {
    //        return null;
    //    }
    //    // Return `null` if the term should not be displayed
    //    return null;
    //}
    var options =
    {
        'templateSelection': custom_template,
        'templateResult': custom_template,
        'minimumInputLength': 3,
        'maximumSelectionLength': maxNumber - 1,
        'maximumInputLength': 30,// only allow terms up to 20 characters long
        'placeholder': 'Select Items',
        'maximumResultsForSearch': 4,
        //    'matcher': matchStart,
    }
    $('#id_select2_example').select2(options);
    $('.select2-container--default .select2-selection--single').css({ 'height': '100px' });
    $('.select2-container--default .select2-selection--single').css({ 'width': '200px' });
    function test(e) {
        var lmindex = 0;
        var optionSelected = $("option:selected", e);
        var valueSelected = e.value;
        //alert(optionSelected);
        //alert(valueSelected);
        var selectedIds = [];
        //var tbody=document.getElementById("rows")

        var liEle = document.getElementsByClassName("select2-selection__choice");
        // if (liEle.length >= minNumber - 1) {
        //     $('#submitbtn').prop('disabled', false);
        // }
        // else {
        //     $('#submitbtn').prop('disabled', true);

        // }
        if (liEle.length <= maxNumber - 1) {
            document.getElementById("SelectedEmployeeNumbers").value = "";
            for (var i = 0; i < liEle.length; i++) {
                // var row =document.createElement("tr");
                // var td1 = document.createElement("td");
                // var td2 = document.createElement("td");
                // var td3 = document.createElement("td");
                var iid = liEle[i].children[1].getAttribute("id");
              //  var iid = liEle[i].children[1].children[2].textContent;
               
               //  var nmm =document.getElementById("lmtest").innerText;
                //alert(nmm);
                selectedIds.push(iid);
                document.getElementById("SelectedEmployeeNumbers").value = document.getElementById("SelectedEmployeeNumbers").value + iid + ";";
                //td1.innerHTML = iid;
                //td2.innerHTML = $(obj.element).text();
               // var inp = document.createElement("input");
              //  td3.appendChild(inp);
                // row.appendChild(td1);
                // row.appendChild(td2);
                // row.appendChild(td3);
                // tbody.appendChild(row);
            }
        }
        else {
            alert("you can not add new members, you reach the maximum number of participants");
        }


    }


</script>

<script>
    function myFunction(value, items) {
        var val = value;
        console.log(val);
        for (let i = 0; i < items.length; i++) {
            console.log(items.length);
            console.log(items[3].UserName);
            if (items[i].Name == val || val == "") {
                console.log("done");
                document.getElementById(items[i].Id).hidden = false;
                //document.getElementById("lm+" + items[i].RequestNumber).hidden = false;
            }
            else {
                document.getElementById(items[i].Id).hidden = true;
                // document.getElementById("lm+" + items[i].RequestNumber).hidden = true;
            }
        }

    }

</script>
<script>
    function approve() {
       // alert(typeVal);
        var lmids = document.getElementById("SelectedEmployeeNumbers").value;
        var lmentity = document.getElementById("select-users").value;
        if (lmids == "") {
            alert("Please select Items");
        }
        else if(lmentity=="")
        {
            alert("please select Entity");
        }
        else {
           // alert(lmids);
            $.ajax({
                url: '@Url.Content("~/")' + "more4u/MedicalRequest/GetItems",
                data: { Id: lmids },
                type: "POST",
                async: true,
                success: function (data) {
                    if (data != null) {
                        var dataJSON = JSON.parse(data);
                        //alert(dataJSON.length);
                     
                        if (dataJSON.length > 0) {
                            var tbody = document.getElementById("lmtbody");// $('#ResourceTable tbody');//
                            tbody.innerHTML = "";
                            document.getElementById("lmtable").hidden = false;
                            for (var index = 0; index < dataJSON.length; index++) {
                               // alert(dataJSON[index]['DrugName']);
                                var row =document.createElement("tr");
                                var td1 = document.createElement("td");
                                var td2 = document.createElement("td");
                                td2.setAttribute("class", "modernWay");
                               // td2.setAttribute("colspan", "2");
                                var td3 = document.createElement("td");
                                var td4 = document.createElement("td");
                                var td5 = document.createElement("td");
                               // td5.setAttribute("class", "modernWay");
                                td1.innerHTML = dataJSON[index]['Id'];
                                td2.innerHTML = dataJSON[index]['DrugName'];
                                td3.innerHTML = dataJSON[index]['Type'];
                                td4.innerHTML = dataJSON[index]['Dose'];
                                var inp = document.createElement("input");
                                inp.setAttribute("class", "form-control");
                                inp.setAttribute("type", "number");
                                inp.value = 1;
                                 td5.appendChild(inp);
                                row.appendChild(td1);
                                row.appendChild(td2);
                                row.appendChild(td3);
                                row.appendChild(td4);
                                row.appendChild(td5);
                                tbody.appendChild(row);
                            }
                         
                        }
                        $('#exampleModalMessage').modal('show');
                    }
                    else {
                        alert("failed");
                    }
                }
            });
        }

    }
</script>
<script>
    function getTable() {
        // find headers
        var headers = []
        $('thead th').each(function (i) {
            headers.push($(this).text())
        })
        // result array
        var array = [];
        $('tr').each(function (i) {
            // declare object variable but dont set it's value
            // unless there are objects to find
            var rowObj
            $(this).find('td').each(function (i) {
                if (!rowObj) rowObj = {}
                if (headers[i] == "Quantity") {
                   // alert(headers[i]);
                    console.log(headers[i]);
                    rowObj[headers[i]] = this.firstChild.value;
                }
                else {
                    rowObj[headers[i]] = $(this).text()
                }
            });
            if (rowObj) array.push(rowObj)
        });
       // alert("done");
       // alert(array);
        console.log(array)
        const result = JSON.stringify(array);
        console.log(result);
        const convertArrObj2Obj = arr => Object.keys(arr).reduce((a, c) => (a[c] = arr[c], a), {});

        let obj = Object.assign({}, array);
        console.log("welcome");
        // Display output
        console.log(JSON.stringify(obj));
        var responseModel =
        {
            requestId:  document.getElementById("SelectedRequestId").value,
            medicalItems: obj,
            status: "3",
            medicalEntity: document.getElementById("select-users").value,
            feedback: "any",
            responseComment: document.getElementById("message-text").value,
        };
        console.log(responseModel);
       
       // var Id = document.getElementById("SelectedEmployeeNumbers").value;
          $.ajax({
              url: '@Url.Content("~/")' + "more4u/MedicalRequest/AddResponse",
              data: { responseModel: responseModel, items:array },
              async: true,
              type: "POST",
      success: function (data) {
          if (data != null) {
              var dataJSON = JSON.parse(data);
             // alert(dataJSON);
                    $('#exampleModalMessage').modal('toggle');
                    window.location.href = "@Url.RouteUrl(new { Controller = "MedicalRequest", Action = "Details" })/?id=" + dataJSON
          }
          else {
              alert("failed");
          }
      }
  });

    }
</script>

<script>
    function reject() {
     
        $('#exampleModalReject').modal('show');
    }
</script>

<script>
    function getReject() {  
        var responseModel =
        {
            requestId: document.getElementById("SelectedRequestId").value,
            //medicalItems: obj,
            status: "4",
            medicalEntity: document.getElementById("select-users").value,
            feedback: "any",
            responseComment: document.getElementById("message-textlm").value,
        };
        console.log(responseModel);
        $.ajax({
            url: '@Url.Content("~/")' + "more4u/MedicalRequest/AddResponse",
            data: { responseModel: responseModel },
            async: true,
            type: "POST",
            success: function (data) {
                if (data != null) {
                    var dataJSON = JSON.parse(data);
                   // alert(dataJSON);
                    $('#exampleModalReject').modal('toggle');
                    window.location.href = "@Url.RouteUrl(new { Controller = "MedicalRequest", Action = "Details" })/?id=" + dataJSON 
                }
                else {
                    alert("failed");
                }
            }
        });

    }
</script>

<script>
    function approvee() {

        $('#exampleModalApprove').modal('show');
    }
</script>

<script>
    function getApprovee() {

        var responseModel =
        {
            requestId: document.getElementById("SelectedRequestId").value,
            //medicalItems: obj,
            status: "3",
            medicalEntity: document.getElementById("select-users").value,
            feedback: "any",
            responseComment: document.getElementById("message-textlmm").value,
        };
        console.log(responseModel);

        // var Id = document.getElementById("SelectedEmployeeNumbers").value;
        $.ajax({
            url: '@Url.Content("~/")' + "more4u/MedicalRequest/AddResponse",
            data: { responseModel: responseModel },
            async: true,
            type: "POST",
            success: function (data) {
                if (data != null) {
                    var dataJSON = JSON.parse(data);
                   // alert(dataJSON);
                    $('#exampleModalApprove').modal('toggle');
                    window.location.href = "@Url.RouteUrl(new { Controller = "MedicalRequest", Action = "Details" })/?id=" + dataJSON
                }
                else {
                    alert("failed");
                }
            }
        });

    }
</script>


@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
